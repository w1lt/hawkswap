<!DOCTYPE html>
<html>
  <head>
    <title>{{ listing.name }}</title>
  </head>
  <body>
    {% include 'header.html' %}
    <h1>{{ listing.name }} - ${{ listing.price }}</h1>
    <script>
      // if the current user is the seller, show an edit button
      if ("{{ current_user.username }}" == "{{ sellerusername }}") {
        document.write(
          `<form action="/listing/{{ listing.id }}/edit">
              <input type="submit" value="Edit Listing" />
            </form>`
        );
      }
    </script>

    <p>
      Posted
      <script>
        var dateposted = new Date("{{ listing.dateposted }}");
        var currentdate = new Date();
        var diff = currentdate - dateposted;
        var days = Math.floor(diff / (1000 * 60 * 60 * 24));
        var hours = Math.floor(diff / (1000 * 60 * 60));
        if (days == 0) {
          if (hours == 0) {
            var minutes = Math.floor(diff / (1000 * 60));
            if (minutes == 0) {
              document.write("just now");
            } else {
              document.write(minutes + " minutes ago");
            }
          } else {
            document.write(hours + " hours ago");
          }
        } else {
          document.write(days + " days ago");
        }
      </script>
      by <a href="/user/{{ sellerusername }}">{{ sellerusername }}</a>
    </p>
    <p>{{ listing.description }}</p>
    <script>
      if ("{{ current_user.username }}" != "{{ sellerusername }}") {
        document.write(
          `<form action="/message-seller/{{ listing.id }}">
            <input type="submit" value="Message Seller" />
          </form>`
        );
      }
    </script>
  </body>
</html>
