{% extends 'base.html' %} {% block title %}{{ listing.name }}{% endblock %} {%
block content %}
<div>
  <img
    src="{{ url_for('static', filename=listing.image_path) }}"
    alt="{{ listing.name }}"
  />
  <div class="listing-title">
    <h2>{{ listing.name }} - ${{ listing.price }}</h2>
    {% if saved %}
    <form
      action="/save-listing/{{ listing.id }}"
      method="post"
      class="heart-form"
    >
      <button type="submit" class="heart-btn saved">
        <i class="fas fa-heart"></i>
      </button>
    </form>
    {% else %}
    <form
      action="/save-listing/{{ listing.id }}"
      method="post"
      class="heart-form"
    >
      <button type="submit" class="heart-btn">
        <i class="far fa-heart"></i>
      </button>
    </form>
    {% endif %} {% if listing.is_sold %}
    <p style="color: red">SOLD</p>
    {% endif %}
  </div>

  {% if current_user.username == sellerusername %}
  <div class="edit-buttons">
    <form action="/listing/{{ listing.id }}/edit">
      <button type="submit">Edit Listing</button>
    </form>
  </div>
  {% endif %}

  <p>{{ listing.description }}</p>

  {% if chat.chat_id == "" and current_user.username != sellerusername %}
  <form action="/message-seller/{{ listing.id }}" method="post">
    <label for="message">Message:</label>
    <textarea
      id="message"
      name="message"
      placeholder="Hi {{ sellerusername }}, is this still available?"
    ></textarea
    ><br /><br />
    <button type="submit">Message Seller</button>
  </form>
  {% elif chat.chat_id != "" %}
  <form action="/chat/{{ chat.chat_id }}">
    <button type="submit">Go to Chat</button>
  </form>
  {% endif %}
  <div class="listing-date">
    Posted
    <script>
      var dateposted = new Date("{{ listing.dateposted }}");
      var currentdate = new Date();
      var diff = currentdate - dateposted;
      var days = Math.floor(diff / (1000 * 60 * 60 * 24));
      var hours = Math.floor(diff / (1000 * 60 * 60));
      if (days == 0) {
        if (hours == 0) {
          var minutes = Math.floor(diff / (1000 * 60));
          if (minutes == 0) {
            document.write("just now");
          } else {
            document.write(minutes + " minutes ago");
          }
        } else {
          document.write(hours + " hours ago");
        }
      } else {
        document.write(days + " days ago");
      }
    </script>
    by <a href="/user/{{ sellerusername }}">{{ sellerusername }}</a>
  </div>
</div>
{% endblock %}
